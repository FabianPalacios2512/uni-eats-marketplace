<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Uni-Eats</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden; /* Prevenir scroll horizontal */
            max-width: 100vw; /* Limitar ancho m谩ximo */
        }
        /* Prevenir scroll horizontal en todos los elementos */
        * {
            max-width: 100%;
            box-sizing: border-box;
        }
        /* Ocultar scrollbars en carruseles */
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        /* Estilo para navegaci贸n activa con tema teal/emerald */
        .nav-link.active i, .nav-link.active span { color: #14b8a6; /* teal-500 */ }
        .nav-link.active .w-9 { background: linear-gradient(to right, #14b8a6, #10b981); /* teal-500 to emerald-500 */ }
        .skeleton { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; background-color: #e5e7eb; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 1; line-clamp: 1; }
        .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-clamp: 2; }
        .qty-btn { width: 2.5rem; height: 2.5rem; border-radius: 9999px; background-color: #f1f5f9; font-weight: bold; font-size: 1.25rem; color: #14b8a6; }
        .profile-link { display: flex; align-items: center; padding: 1rem; border-bottom-width: 1px; }
        .profile-link:hover { background-color: #f8fafc; }
        .profile-icon { width: 2rem; text-align: center; }
        .producto-card { display: flex; align-items: center; gap: 1rem; background-color: white; padding: 0.75rem; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .add-to-cart-btn { flex-shrink: 0; width: 2.5rem; height: 2.5rem; border-radius: 9999px; background-color: #ccfbf1; color: #0f766e; font-size: 1.25rem; font-weight: bold; transition: transform 0.1s; }
        .add-to-cart-btn:active { transform: scale(0.9); }
        .cart-qty-btn { width: 2rem; height: 2rem; border-radius: 9999px; background-color: #f1f5f9; font-weight: bold; color: #14b8a6; }
        @keyframes pop-in { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-pop-in { animation: pop-in 0.3s ease-out forwards; }
        @keyframes slide-down { from { transform: translate(-50%, -100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .animate-slide-down { animation: slide-down 0.4s ease-out forwards; }
        @keyframes fade-out { to { opacity: 0; } }
        .animate-fade-out { animation: fade-out 0.3s ease-in forwards; }
        
        /*  NAVEGACIN FIJA MOBILE */
        #app-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 99999 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border-top: 1px solid #e5e7eb !important;
            padding-bottom: env(safe-area-inset-bottom, 8px) !important;
            box-shadow: 0 -4px 6px -1px rgb(0 0 0 / 0.1) !important;
        }
        
        /* Espacio para el contenido para que no se oculte detr谩s del nav */
        #app-container {
            padding-bottom: 75px !important; /* Altura del nav + margen extra */
            min-height: calc(100vh - 75px) !important;
        }
        
        /* Ajuste del contenedor principal */
        body .bg-gradient-to-br {
            padding-bottom: 0 !important;
        }
        
        /* En m贸viles, ajustar para navegaci贸n */
        @media (display-mode: standalone) {
            #app-nav {
                padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px)) !important;
            }
            #app-container {
                padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px)) !important;
                min-height: calc(100vh - 100px - env(safe-area-inset-bottom, 0px)) !important;
            }
        }

        /*  PWA STANDALONE STYLES */
        .pwa-standalone {
            /* Optimizar para modo PWA standalone */
            isolation: isolate;
        }
        
        .pwa-standalone body {
            /* Optimizar para pantalla completa */
            overflow-x: hidden;
            user-select: none; /* Prevenir selecci贸n accidental */
            -webkit-user-select: none;
            -webkit-touch-callout: none; /* Prevenir men煤 contextual en iOS */
        }
        
        .pwa-standalone #app-header {
            /* Header m谩s prominente en PWA */
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(20px) !important;
        }
        
        .pwa-standalone #app-nav {
            /* Navegaci贸n m谩s nativa en PWA */
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(20px) !important;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Transiciones suaves para PWA */
        .pwa-standalone * {
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (display-mode: standalone) {
            /* Estilos autom谩ticos cuando est谩 en modo standalone */
            body {
                background-color: #ffffff !important;
            }
            
            #app-header {
                padding-top: env(safe-area-inset-top, 20px) !important;
            }
            
            /* Ocultar elementos del navegador si aparecen */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: env(safe-area-inset-top, 0px);
                background: #4f46e5;
                z-index: 9999;
            }
        }

        /* Forzar modo app */
        body[data-app-mode="standalone"] {
            margin: 0 !important;
            padding: 0 !important;
            background: #ffffff !important;
        }
        
        body[data-app-mode="standalone"] #app-header {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000 !important;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="w-full bg-gradient-to-br from-gray-50 via-slate-50 to-gray-100 min-h-screen">
        <header id="app-header" class="sticky top-0 bg-white/95 backdrop-blur-xl shadow-md z-20 border-b border-gray-200">
            <!-- Header content will be managed by JavaScript -->
        </header>
        <main id="app-container" class="px-1 pt-1"></main>
    </div>

    <nav id="app-nav" class="flex justify-around shadow-lg py-3 bg-white/95 backdrop-blur-xl">
        <a href="#" class="nav-link active flex flex-col items-center justify-center w-full py-1 relative group" data-view="inicio">
            <div class="w-9 h-9 bg-gradient-to-r from-teal-500 to-emerald-500 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                <i class="fas fa-home text-white text-sm"></i>
            </div>
            <span class="text-xs text-teal-600 font-semibold mt-1 group-hover:text-teal-700 transition-colors">Inicio</span>
        </a>
        <a href="#" class="nav-link flex flex-col items-center justify-center w-full py-1 relative group" data-view="tiendas">
            <div class="w-9 h-9 bg-gray-100 rounded-2xl flex items-center justify-center group-hover:bg-gradient-to-r group-hover:from-cyan-500 group-hover:to-blue-500 transition-all shadow-lg group-hover:scale-110">
                <i class="fas fa-store text-gray-500 text-sm group-hover:text-white transition-colors"></i>
            </div>
            <span class="text-xs text-gray-600 font-semibold mt-1 group-hover:text-cyan-600 transition-colors">Tiendas</span>
        </a>
        <a href="#" class="nav-link flex flex-col items-center justify-center w-full py-1 relative group" data-view="misPedidos">
            <div class="w-9 h-9 bg-gray-100 rounded-2xl flex items-center justify-center group-hover:bg-gradient-to-r group-hover:from-purple-500 group-hover:to-pink-500 transition-all shadow-lg group-hover:scale-110">
                <i class="fas fa-receipt text-gray-500 text-sm group-hover:text-white transition-colors"></i>
            </div>
            <span class="text-xs text-gray-600 font-semibold mt-1 group-hover:text-purple-600 transition-colors">Pedidos</span>
        </a>
    </nav>
    
    <!-- Main App Script -->
    <script th:src="@{/js/comprador.js}"></script>

    <script>
        // Dashboard functionality for students
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar indicador de conexi贸n
            const nav = document.getElementById('app-nav');
            if (nav) {
                const connectionIndicator = document.createElement('div');
                connectionIndicator.innerHTML = `
                    <i class="fas fa-wifi network-status-icon text-green-500 text-xs"></i>
                `;
                connectionIndicator.className = 'absolute top-1 right-2 z-50';
                nav.style.position = 'relative';
                nav.appendChild(connectionIndicator);
            }

            // Pull-to-refresh en m贸viles
            let startY = 0;
            let pullDistance = 0;
            const container = document.getElementById('app-container');
            
            if (container) {
                container.addEventListener('touchstart', (e) => {
                    startY = e.touches[0].clientY;
                });

                container.addEventListener('touchmove', (e) => {
                    const currentY = e.touches[0].clientY;
                    pullDistance = currentY - startY;
                    
                    if (pullDistance > 0 && window.scrollY === 0) {
                        e.preventDefault();
                        // Visual feedback para pull-to-refresh
                        if (pullDistance > 60) {
                            document.body.style.transform = `translateY(${Math.min(pullDistance * 0.3, 30)}px)`;
                        }
                    }
                });

                container.addEventListener('touchend', () => {
                    if (pullDistance > 60 && window.scrollY === 0) {
                        // Trigger refresh
                        window.location.reload();
                    }
                    
                    // Reset transform
                    document.body.style.transform = '';
                    pullDistance = 0;
                });
            }
        });
    </script>
</body>
</html>